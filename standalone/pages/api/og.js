import { ImageResponse } from '@vercel/og';
import { NextRequest } from 'next/server';

export const config = {
    runtime: 'edge',
};

export default function handler(request) {
    try {
        const { searchParams } = new URL(request.url);

        // ?title=<title>
        const hasTitle = searchParams.has('title');
        const title = hasTitle
            ? searchParams.get('title')?.slice(0, 100)
            : '';
        const hasSubTitle = searchParams.has('subtitle');
        const subtitle = hasSubTitle
            ? searchParams.get('subtitle')?.slice(0, 100)
            : '';

        return new ImageResponse(
            (
                <div
                    style={{
                        backgroundColor: '#FFEA00',
                        backgroundSize: '150px 150px',
                        height: '100%',
                        width: '100%',
                        display: 'flex',
                        textAlign: 'center',
                        alignItems: 'center',
                        justifyContent: 'center',
                        flexDirection: 'column',
                        flexWrap: 'nowrap',
                    }}
                >
                    <div
                        style={{
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            justifyItems: 'center',
                        }}
                    >
                        <svg width="433" height="112" viewBox="0 0 433 112" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M48.3437 57.3125C64.3125 44.4062 63.875 25.8125 59.0625 7C68.6875 18.5938 70.2188 30.625 68.9062 41.7812C72.8438 36.5312 73.7917 29.8958 74.5937 25.8125C80.02 41.8668 76.3438 50.3125 71.3125 56.4375C77.875 52.2812 82.6875 41.7812 82.6875 41.7812C82.6875 41.7812 80.2812 73.2767 62.125 77.4375C49.7159 80.2812 43.75 77 35 85.5312C27.6938 92.6548 30.4062 103.469 39.375 103.469C44.625 102.812 45.7188 99.3125 45.7188 98C45.7188 95.8125 43.9687 94.0625 42 94.0625C40.0312 94.0625 38.7671 95.2124 37.625 96.4688C37.625 96.4688 39.1369 93.1875 42.6562 93.1875C47.25 93.1875 49.113 99.0109 44.4062 102.812C38.7188 107.406 24.5 104.125 24.5 88.1562C24.5 77.2188 34.8765 68.197 48.3437 57.3125Z" fill="black" />
                            <path d="M135 49.4995H157.939V57.0473H135V49.4995ZM160.013 31.37V39.0658C159.52 39.0658 157.002 39.0658 156.459 39.0658C155.966 39.0658 155.448 39.0658 154.905 39.0658C152.636 39.0658 151.107 39.6084 150.318 40.6937C149.578 41.779 149.208 43.2343 149.208 45.0596V86.0545H140.254V45.0596C140.254 41.705 140.797 39.0164 141.882 36.9938C142.967 34.9219 144.496 33.4173 146.47 32.48C148.443 31.4933 150.737 31 153.351 31C154.091 31 154.856 31.0247 155.645 31.074C156.484 31.1233 159.273 31.222 160.013 31.37Z" fill="black" />
                            <path d="M189.479 49.4995H197.618V86.0545H189.257L188.665 80.3566C187.53 82.2312 185.877 83.8099 183.707 85.0925C181.536 86.3751 178.971 87.0164 176.011 87.0164C172.459 87.0164 169.401 86.1778 166.835 84.5005C164.27 82.7739 162.321 80.4306 160.989 77.4707C159.658 74.5108 158.992 71.1316 158.992 67.333C158.992 63.4851 159.707 60.1552 161.137 57.3433C162.568 54.5313 164.566 52.3361 167.131 50.7575C169.746 49.1788 172.755 48.3895 176.159 48.3895C178.872 48.3895 181.388 48.9815 183.707 50.1655C186.075 51.3001 187.826 52.9527 188.961 55.1233L189.479 49.4995ZM188.517 67.777C188.517 65.557 188.097 63.6084 187.259 61.9311C186.42 60.2539 185.211 58.9466 183.633 58.0093C182.104 57.0719 180.303 56.6033 178.231 56.6033C176.159 56.6033 174.334 57.0966 172.755 58.0832C171.226 59.0206 170.042 60.3279 169.203 62.0051C168.414 63.6824 168.019 65.6064 168.019 67.777C168.019 69.9476 168.414 71.8715 169.203 73.5488C170.042 75.2261 171.226 76.5581 172.755 77.5447C174.284 78.482 176.085 78.9507 178.157 78.9507C180.278 78.9507 182.104 78.482 183.633 77.5447C185.162 76.6074 186.346 75.3001 187.185 73.6228C188.073 71.8962 188.517 69.9476 188.517 67.777Z" fill="black" />
                            <path d="M202.01 74.9548H210.594C210.643 76.5334 211.235 77.7914 212.37 78.7287C213.505 79.666 215.083 80.1346 217.106 80.1346C219.277 80.1346 220.905 79.74 221.99 78.9507C223.124 78.1614 223.692 77.1007 223.692 75.7688C223.692 74.8808 223.396 74.0915 222.804 73.4008C222.212 72.7102 221.102 72.1922 219.474 71.8469L212.888 70.2929C209.583 69.5529 207.116 68.369 205.488 66.741C203.91 65.0637 203.12 62.7698 203.12 59.8592C203.12 57.4913 203.737 55.444 204.97 53.7174C206.253 51.9907 207.98 50.6835 210.15 49.7955C212.321 48.8582 214.812 48.3895 217.624 48.3895C220.337 48.3895 222.73 48.8828 224.802 49.8695C226.874 50.8561 228.477 52.2374 229.612 54.0134C230.796 55.7893 231.412 57.8613 231.462 60.2292H222.878C222.878 58.6506 222.384 57.4173 221.398 56.5293C220.411 55.592 219.03 55.1233 217.254 55.1233C215.478 55.1233 214.097 55.518 213.11 56.3073C212.123 57.0966 211.63 58.1572 211.63 59.4892C211.63 61.5118 213.209 62.8931 216.366 63.6331L222.952 65.187C226.01 65.8777 228.304 66.9877 229.834 68.517C231.412 70.0462 232.202 72.2169 232.202 75.0288C232.202 77.4954 231.56 79.6413 230.278 81.4666C228.995 83.2425 227.194 84.6238 224.876 85.6105C222.557 86.5478 219.893 87.0164 216.884 87.0164C212.345 87.0164 208.72 85.9065 206.006 83.6865C203.342 81.4666 202.01 78.556 202.01 74.9548Z" fill="black" />
                            <path d="M233.969 49.4995H257.057V57.0473H233.969V49.4995ZM250.027 86.0545H240.999V38.1038H250.027V86.0545Z" fill="black" />
                            <path d="M275.923 87.0164C272.371 87.0164 269.313 86.2271 266.748 84.6485C264.232 83.0206 262.258 80.776 260.828 77.9147C259.446 75.0534 258.756 71.7235 258.756 67.925C258.756 64.1264 259.446 60.7718 260.828 57.8613C262.258 54.9013 264.306 52.5827 266.97 50.9054C269.634 49.2282 272.791 48.3895 276.441 48.3895C279.007 48.3895 281.35 48.9075 283.471 49.9435C285.592 50.9301 287.22 52.3361 288.355 54.1614V31H297.309V86.0545H289.021L288.429 80.3566C287.344 82.4286 285.666 84.0565 283.397 85.2405C281.177 86.4245 278.686 87.0164 275.923 87.0164ZM277.921 78.7287C280.043 78.7287 281.868 78.2847 283.397 77.3967C284.926 76.4594 286.11 75.1521 286.949 73.4748C287.837 71.7482 288.281 69.7996 288.281 67.629C288.281 65.409 287.837 63.4851 286.949 61.8571C286.11 60.1799 284.926 58.8726 283.397 57.9353C281.868 56.9486 280.043 56.4553 277.921 56.4553C275.849 56.4553 274.049 56.9486 272.519 57.9353C270.99 58.8726 269.806 60.1799 268.968 61.8571C268.178 63.5344 267.784 65.4584 267.784 67.629C267.784 69.7996 268.178 71.7235 268.968 73.4008C269.806 75.0781 270.99 76.3854 272.519 77.3227C274.049 78.26 275.849 78.7287 277.921 78.7287Z" fill="black" />
                            <path d="M333.578 49.4995H341.718V86.0545H333.356L332.764 80.3566C331.63 82.2312 329.977 83.8099 327.806 85.0925C325.636 86.3751 323.07 87.0164 320.111 87.0164C316.559 87.0164 313.5 86.1778 310.935 84.5005C308.37 82.7739 306.421 80.4306 305.089 77.4707C303.757 74.5108 303.091 71.1316 303.091 67.333C303.091 63.4851 303.806 60.1552 305.237 57.3433C306.668 54.5313 308.666 52.3361 311.231 50.7575C313.845 49.1788 316.855 48.3895 320.259 48.3895C322.972 48.3895 325.488 48.9815 327.806 50.1655C330.174 51.3001 331.926 52.9527 333.06 55.1233L333.578 49.4995ZM332.616 67.777C332.616 65.557 332.197 63.6084 331.358 61.9311C330.52 60.2539 329.311 58.9466 327.732 58.0093C326.203 57.0719 324.402 56.6033 322.331 56.6033C320.259 56.6033 318.433 57.0966 316.855 58.0832C315.325 59.0206 314.141 60.3279 313.303 62.0051C312.513 63.6824 312.119 65.6064 312.119 67.777C312.119 69.9476 312.513 71.8715 313.303 73.5488C314.141 75.2261 315.325 76.5581 316.855 77.5447C318.384 78.482 320.185 78.9507 322.257 78.9507C324.378 78.9507 326.203 78.482 327.732 77.5447C329.262 76.6074 330.446 75.3001 331.284 73.6228C332.172 71.8962 332.616 69.9476 332.616 67.777Z" fill="black" />
                            <path d="M349.644 103V49.4995H358.006L358.598 55.0493C359.683 52.9281 361.361 51.3001 363.63 50.1655C365.899 48.9815 368.391 48.3895 371.104 48.3895C374.606 48.3895 377.616 49.1788 380.132 50.7575C382.697 52.3361 384.695 54.5313 386.125 57.3433C387.556 60.1552 388.271 63.4851 388.271 67.333C388.271 71.1316 387.605 74.5108 386.273 77.4707C384.941 80.4306 382.993 82.7739 380.428 84.5005C377.912 86.1778 374.828 87.0164 371.178 87.0164C368.465 87.0164 365.973 86.4985 363.704 85.4625C361.484 84.4265 359.807 82.9959 358.672 81.1706V103H349.644ZM358.746 67.777C358.746 69.9476 359.166 71.8715 360.004 73.5488C360.843 75.2261 362.027 76.5581 363.556 77.5447C365.135 78.482 366.96 78.9507 369.032 78.9507C371.153 78.9507 372.978 78.482 374.508 77.5447C376.037 76.5581 377.196 75.2261 377.986 73.5488C378.775 71.8715 379.17 69.9476 379.17 67.777C379.17 65.6064 378.775 63.6824 377.986 62.0051C377.196 60.3279 376.037 59.0206 374.508 58.0832C372.978 57.0966 371.153 56.6033 369.032 56.6033C366.96 56.6033 365.135 57.0719 363.556 58.0093C362.027 58.9466 360.843 60.2539 360.004 61.9311C359.166 63.6084 358.746 65.557 358.746 67.777Z" fill="black" />
                            <path d="M393.98 103V49.4995H402.341L402.933 55.0493C404.019 52.9281 405.696 51.3001 407.965 50.1655C410.235 48.9815 412.726 48.3895 415.439 48.3895C418.942 48.3895 421.951 49.1788 424.467 50.7575C427.032 52.3361 429.03 54.5313 430.461 57.3433C431.891 60.1552 432.607 63.4851 432.607 67.333C432.607 71.1316 431.941 74.5108 430.609 77.4707C429.277 80.4306 427.328 82.7739 424.763 84.5005C422.247 86.1778 419.164 87.0164 415.513 87.0164C412.8 87.0164 410.309 86.4985 408.039 85.4625C405.819 84.4265 404.142 82.9959 403.007 81.1706V103H393.98ZM403.081 67.777C403.081 69.9476 403.501 71.8715 404.339 73.5488C405.178 75.2261 406.362 76.5581 407.891 77.5447C409.47 78.482 411.295 78.9507 413.367 78.9507C415.488 78.9507 417.314 78.482 418.843 77.5447C420.372 76.5581 421.532 75.2261 422.321 73.5488C423.11 71.8715 423.505 69.9476 423.505 67.777C423.505 65.6064 423.11 63.6824 422.321 62.0051C421.532 60.3279 420.372 59.0206 418.843 58.0832C417.314 57.0966 415.488 56.6033 413.367 56.6033C411.295 56.6033 409.47 57.0719 407.891 58.0093C406.362 58.9466 405.178 60.2539 404.339 61.9311C403.501 63.6084 403.081 65.557 403.081 67.777Z" fill="black" />
                        </svg>

                    </div>
                    <div
                        style={{
                            fontSize: 70,
                            fontStyle: 'normal',
                            letterSpacing: '-0.025em',
                            color: 'black',
                            marginTop: 10,
                            padding: '0 12px',
                            lineHeight: 1.4,
                            whiteSpace: 'pre-wrap',
                        }}
                    >
                        {title}
                    </div>
                    <div
                        style={{
                            fontSize: 30,
                            fontStyle: 'normal',
                            color: 'black',
                            marginTop: 0,
                            whiteSpace: 'pre-wrap',
                        }}
                    >
                        {subtitle}
                    </div>
                </div>
            ),
            {
                width: 1200,
                height: 630,
            },
        );
    } catch (e) {
        console.log(`${e.message}`);
        return new Response(`Failed to generate the image`, {
            status: 500,
        });
    }
}